<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Every great developer you know got there by solving problems they were unqualified to solve until they actually did it."><title>Java_SSL详解(一) | Just Do It</title><link rel="stylesheet" type="text/css" href="/blog_deploy/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/blog_deploy/favicon.ico"><link rel="apple-touch-icon" href="/blog_deploy/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/blog_deploy/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/blog_deploy/atom.xml"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-120855082-1','auto');ga('send','pageview');
</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Java_SSL详解(一)</h1><a id="logo" href="/blog_deploy/.">Just Do It</a><p class="description">Every great developer you know got there by solving problems they were unqualified to solve until they actually did it.</p></div><div id="nav-menu"><a class="current" href="/blog_deploy/."><i class="fa fa-home"> 首页</i></a><a href="/blog_deploy/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/blog_deploy/about/"><i class="fa fa-user"> 关于</i></a><a href="/blog_deploy/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Java_SSL详解(一)</h1><div class="post-meta">Jun 15, 2018</div><div class="post-content"><p>如果你需要从CA机构获取SSL的证书,你就必须创建一个证书认证请求(Certificate Signing Request, CSR).CSR主要包含的内容是一个公钥和一些额外的信息,当这个CSR被CA机构所认证后,这两个信息都会被写入证书中(也就是.cer文件中).</p>
<p>当你在创建CSR文件的时候,会被要求提供关于创建证书所需要的一些信息.就是我们熟知的Distinguised Name(DN).DN中比较重要的一个属性是CommonName(CN), 也就是打算使用该域名的确切完全的限定域名(FQDN). 录入的方式不仅仅限于交互提示的命令行的方式, 也可以使用直接在一行命令中提供信息或者是文件来提供信息的方式.</p>
<p>DN中其它的信息则是放置关于你的网站的组织和公司的信息.如果你是从一个权威的CA认证机构来购买的的SSL证书, 这些信息往往是需要详细去提供的.</p>
<h3 id="产生CSR的方式"><a href="#产生CSR的方式" class="headerlink" title="产生CSR的方式"></a>产生CSR的方式</h3><h4 id="如果你已经有了一个私钥-此时你需要向一个CA请求一个证书-可以使用下面这个命令"><a href="#如果你已经有了一个私钥-此时你需要向一个CA请求一个证书-可以使用下面这个命令" class="headerlink" title="如果你已经有了一个私钥,此时你需要向一个CA请求一个证书,可以使用下面这个命令"></a>如果你已经有了一个私钥,此时你需要向一个CA请求一个证书,可以使用下面这个命令</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl req \</span><br><span class="line">       -key domain.key \</span><br><span class="line">       -new -out domain.csr</span><br></pre></td></tr></table></figure>
<p>根据命令行的提示,一步步补充所需信息.</p>
<blockquote>
<p>-key的option配置表示一个存在private.key的文件地址.-new的option配置表示这里会重新产生一个新的CSR文件.</p>
</blockquote>
<h4 id="如果你需要续订现有的证书-但是CA或者你自己又没有保存之前的CSR文件-此时你需要重新生成一个CSR文件-可以使用下面这种办法"><a href="#如果你需要续订现有的证书-但是CA或者你自己又没有保存之前的CSR文件-此时你需要重新生成一个CSR文件-可以使用下面这种办法" class="headerlink" title="如果你需要续订现有的证书,但是CA或者你自己又没有保存之前的CSR文件,此时你需要重新生成一个CSR文件, 可以使用下面这种办法"></a>如果你需要续订现有的证书,但是CA或者你自己又没有保存之前的CSR文件,此时你需要重新生成一个CSR文件, 可以使用下面这种办法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 \</span><br><span class="line">       -in domain.crt \</span><br><span class="line">       -signkey domain.key \</span><br><span class="line">       -x509toreq -out domain.csr</span><br></pre></td></tr></table></figure>
<blockquote>
<p>-x509toreq表示正在使用X509证书来创建一个CSR</p>
</blockquote>
<h4 id="如果你需要使用SSL证书来加密你的服务-但是你又不需要CA进行签名认证的证书-最简单的办法是自己来进行签名-可以使用下面这种办法"><a href="#如果你需要使用SSL证书来加密你的服务-但是你又不需要CA进行签名认证的证书-最简单的办法是自己来进行签名-可以使用下面这种办法" class="headerlink" title="如果你需要使用SSL证书来加密你的服务,但是你又不需要CA进行签名认证的证书, 最简单的办法是自己来进行签名, 可以使用下面这种办法**"></a>如果你需要使用SSL证书来加密你的服务,但是你又不需要CA进行签名认证的证书, 最简单的办法是自己来进行签名, 可以使用下面这种办法**</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl req \</span><br><span class="line">       -newkey rsa:2048 -nodes -keyout domain.key \</span><br><span class="line">       -x509 -days 365 -out domain.crt</span><br></pre></td></tr></table></figure>
<p>这个命令创建了一个2048-bit的私钥, 和一个自签名的domain.crt. -x509选项表示表示告诉 req 创建一个自签名的证书, -days 365 表示这个证书将在365天内是有效的. 一个临时的CSR文件同时也会产生用来存储和证书相关联的信息.</p>
<h4 id="直接通过一个私钥来生成一个自签名的证书"><a href="#直接通过一个私钥来生成一个自签名的证书" class="headerlink" title="直接通过一个私钥来生成一个自签名的证书"></a>直接通过一个私钥来生成一个自签名的证书</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openssl req \</span><br><span class="line">       -key domain.key \</span><br><span class="line">       -new \</span><br><span class="line">       -x509 -days 365 -out domain.crt</span><br></pre></td></tr></table></figure>
<p>x509 选项告诉 req 需要创建一个自签名的证书, -new 表示交互式的方式来填充CSR所需要的信息.</p>
<h4 id="通过一个已有的私钥和CSR文件来生成自签名的证书"><a href="#通过一个已有的私钥和CSR文件来生成自签名的证书" class="headerlink" title="通过一个已有的私钥和CSR文件来生成自签名的证书"></a>通过一个已有的私钥和CSR文件来生成自签名的证书</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 \</span><br><span class="line">       -signkey domain.key \</span><br><span class="line">       -in domain.csr \</span><br><span class="line">       -req -days 365 -out domain.crt</span><br></pre></td></tr></table></figure>
<h3 id="查看证书"><a href="#查看证书" class="headerlink" title="查看证书"></a>查看证书</h3><p>证书和CSR都是以PEM格式进行编码的, 这种格式没法被人直接阅读.所以对于CSR, CRT的文件需要进行工具函数的转化.</p>
<h4 id="阅读CSR内容"><a href="#阅读CSR内容" class="headerlink" title="阅读CSR内容"></a>阅读CSR内容</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -text -noout -verify -in domain.csr</span><br></pre></td></tr></table></figure>
<h4 id="阅读证书的内容"><a href="#阅读证书的内容" class="headerlink" title="阅读证书的内容"></a>阅读证书的内容</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -text -noout -in domain.crt</span><br></pre></td></tr></table></figure>
<h4 id="判断一个证书是否由一个CA所签发-ca-crt是CA机构的证书"><a href="#判断一个证书是否由一个CA所签发-ca-crt是CA机构的证书" class="headerlink" title="判断一个证书是否由一个CA所签发(ca.crt是CA机构的证书)"></a>判断一个证书是否由一个CA所签发(ca.crt是CA机构的证书)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl verify -verbose -CAFile ca.crt domain.crt</span><br></pre></td></tr></table></figure>
<h3 id="Private-Keys相关"><a href="#Private-Keys相关" class="headerlink" title="Private Keys相关"></a>Private Keys相关</h3><h4 id="创建一个2048-bit由密码保护的private-key"><a href="#创建一个2048-bit由密码保护的private-key" class="headerlink" title="创建一个2048-bit由密码保护的private key"></a>创建一个2048-bit由密码保护的private key</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -des3 -out domain.key 2048</span><br></pre></td></tr></table></figure>
<h4 id="判断-private-key-是不是一个合法的-key"><a href="#判断-private-key-是不是一个合法的-key" class="headerlink" title="判断 private key 是不是一个合法的 key"></a>判断 private key 是不是一个合法的 key</h4><p>如果是一个有密码的私钥, 则会有提示输入密码.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl rsa -check -in domain.key</span><br></pre></td></tr></table></figure>
<h4 id="判断private-key和crt文件-csr文件是否为相关联的关系"><a href="#判断private-key和crt文件-csr文件是否为相关联的关系" class="headerlink" title="判断private key和crt文件, csr文件是否为相关联的关系"></a>判断private key和crt文件, csr文件是否为相关联的关系</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl rsa -noout -modulus -in domain.key | openssl md5</span><br><span class="line">openssl x509 -noout -modulus -in domain.crt | openssl md5</span><br><span class="line">openssl req -noout -modulus -in domain.csr | openssl md5</span><br></pre></td></tr></table></figure>
<p>如果这三个输出的值是相等的,则私钥,crt,csr这三者之前的相关联的关系非常高</p>
<h4 id="加解密private-key"><a href="#加解密private-key" class="headerlink" title="加解密private key"></a>加解密private key</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">openssl rsa -des3 \</span><br><span class="line">       -in unencrypted.key \</span><br><span class="line">       -out encrypted.key</span><br><span class="line"></span><br><span class="line">openssl rsa \</span><br><span class="line">       -in encrypted.key \</span><br><span class="line">       -out decrypted.key</span><br></pre></td></tr></table></figure>
<h3 id="改变证书的格式"><a href="#改变证书的格式" class="headerlink" title="改变证书的格式"></a>改变证书的格式</h3><p>到目前为止我们在使用的X.509证书的编码格式是ASCII PEM编码的方式.有很多其它种的编码格式或者容器的类型.有一些应用更偏重于特定的格式,并且所有这些另外的格式会包含多个条目, 比如证书, private key, CA证书包含在一个文件之中.Openssl可以被用来将证书的不同格式进行互相转换.</p>
<h4 id="将PEM转化成DER"><a href="#将PEM转化成DER" class="headerlink" title="将PEM转化成DER"></a>将PEM转化成DER</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 \</span><br><span class="line">       -in domain.crt \</span><br><span class="line">       -outform der -out domain.der</span><br></pre></td></tr></table></figure>
<h4 id="将DER转化为PEM"><a href="#将DER转化为PEM" class="headerlink" title="将DER转化为PEM"></a>将DER转化为PEM</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 \</span><br><span class="line">       -inform der -in domain.der \</span><br><span class="line">       -out domain.crt</span><br></pre></td></tr></table></figure>
<h4 id="将PEM转化为PKCS7"><a href="#将PEM转化为PKCS7" class="headerlink" title="将PEM转化为PKCS7"></a>将PEM转化为PKCS7</h4><p>下面这个命令的作用是将签名证书domain.crt和CA证书链打包成一个PKCS7 文件(domain.p7b).PKCS7 文件, 也就是P7B文件, 常常被使用与java KeyStores和Microsoft IIS. 他们都是包含签名后证书和CA证书的ASCII文件.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openssl crl2pkcs7 -nocrl \</span><br><span class="line">       -certfile domain.crt \</span><br><span class="line">       -certfile ca-chain.crt \</span><br><span class="line">       -out domain.p7b</span><br></pre></td></tr></table></figure>
<h4 id="将PEM转化成PKCS12"><a href="#将PEM转化成PKCS12" class="headerlink" title="将PEM转化成PKCS12"></a>将PEM转化成PKCS12</h4><p>将私钥和签名证书打包转化成PKCS12文件(domain.pfx).我们也可将ca.crt文件打包进入PKCS12文件中,通过将ca.crt的文件内容添加进入domain.crt文件中.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openssl pkcs12 \</span><br><span class="line">       -inkey domain.key \</span><br><span class="line">       -in domain.crt \</span><br><span class="line">       -export -out domain.pfx</span><br></pre></td></tr></table></figure>
<h3 id="将PKCS12转化为PEM"><a href="#将PKCS12转化为PEM" class="headerlink" title="将PKCS12转化为PEM"></a>将PKCS12转化为PEM</h3><p>将domain.pfx文件转化为crt文件.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl pkcs12 \</span><br><span class="line">       -in domain.pfx \</span><br><span class="line">       -nodes -out domain.combined.crt</span><br></pre></td></tr></table></figure>
<h3 id="如何抓取一个网站的Https签名证书"><a href="#如何抓取一个网站的Https签名证书" class="headerlink" title="如何抓取一个网站的Https签名证书"></a>如何抓取一个网站的Https签名证书</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl s_client -connect www.baidu.com:443</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意: 因为pfx里面可能包含私钥,证书文件,ca.crt文件, 所以PEM文件中会统一包含所有的内容(这也是称之为domain.combined.crt的原因).<br>证书格式分类章内容翻译自作者<br><a href="https://www.digitalocean.com/community/tutorials/openssl-essentials-working-with-ssl-certificates-private-keys-and-csrs" target="_blank" rel="noopener">Mitchell Anicas文章OpenSSL Essentials: Working with SSL Certificates, Private Keys and CSRs</a></p>
</blockquote>
<h2 id="Java如何使用SSL"><a href="#Java如何使用SSL" class="headerlink" title="Java如何使用SSL"></a>Java如何使用SSL</h2><p>SSL提供了2个设备之间通过网络安全通信的连接.主要为了达成以下几个目标:</p>
<ul>
<li>加密: 保护各方之间的数据传输,保证隐私性</li>
<li>认证: 确保我们连接的服务器就是我们所认为的服务器</li>
<li>数据完整性: 确保收到的请求数据就是发出的数据(数据在传输过程中没有被替换)</li>
</ul>
<p>Java提供了几种安全API框架来帮助保障开发者达成上面这三个目标</p>
<ul>
<li>Java Secured-Socket Extension (JSSE)</li>
<li>Java Crytopgraphy Architecture (JCA)</li>
<li>Java Crytographic Extension (JCE)</li>
</ul>
<h3 id="Java-keytool-和-OpenSSL工具的区别"><a href="#Java-keytool-和-OpenSSL工具的区别" class="headerlink" title="Java keytool 和 OpenSSL工具的区别"></a>Java keytool 和 OpenSSL工具的区别</h3><blockquote>
<p>参考stackoverflow: <a href="https://security.stackexchange.com/questions/98282/difference-between-openssl-and-keytool" target="_blank" rel="noopener">Difference between OpenSSL and keytool</a><br>参考<a href="https://www.digitalocean.com/community/tutorials/java-keytool-essentials-working-with-java-keystores" target="_blank" rel="noopener">Java Keytool Essentials: Working with Java Keystores</a></p>
</blockquote>
<p>keytool和Openssl工具的共同点在于, 它们的目标都是为了创建/保存私钥和证书(证书链).Java语言只能处理JKS格式的文件(同时包含了证书和私钥).类似JKY格式的文件的场景是在openssl中所创建的PKCS12(.p12)格式的文件(这也是一个由密码保护的容器包含了私钥和证书),但是.p12格式是不兼容于.jks文件的, Java程序也无法处理, 所以需要将.p12转化成.jks, 这样Java才能进行处理.</p>
<h3 id="创建KeyStore中的条目"><a href="#创建KeyStore中的条目" class="headerlink" title="创建KeyStore中的条目"></a>创建KeyStore中的条目</h3><h4 id="在KeyStore中创建或者更新私钥"><a href="#在KeyStore中创建或者更新私钥" class="headerlink" title="在KeyStore中创建或者更新私钥"></a>在KeyStore中创建或者更新私钥</h4><p>如果你需要HTTPS来保护你的应用, 下面这个命令将创建一个密钥对, 可以用来创建CSR, 并且从CA中获得签名证书. 命令将产生一个2048-bit的RSA私钥对, 挂在条目domain下, 并存于keystore.jks文件中, 如果keystore.jks的这个文件不存在,则会自动进行创建.命令执行后, 会自动提示输入保护密码和相关DN信息的设置.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">keytool -genkeypair \</span><br><span class="line">        -alias domain \</span><br><span class="line">        -keyalg RSA \</span><br><span class="line">        -keystore keystore.jks</span><br></pre></td></tr></table></figure>
<h4 id="导入签名过的证书-CA证书-链-进入jks文件"><a href="#导入签名过的证书-CA证书-链-进入jks文件" class="headerlink" title="导入签名过的证书/CA证书(链)进入jks文件"></a>导入签名过的证书/CA证书(链)进入jks文件</h4><p>比如你需要导入一个CA机构签名认证过的证书进入keystore文件中, 那么这个签名过的证书文件必须和jks文件中的私钥相匹配.也可以使用相同的命令导入CA的根证书或者中间CA证书,以完成CA证书的信任链(只需要将domain替换成root即可, 还有指定你要导入的ca证书文件).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">keytool -importcert \</span><br><span class="line">        -trustcacerts -file domain.crt \</span><br><span class="line">        -alias domain \</span><br><span class="line">        -keystore keystore.jks</span><br></pre></td></tr></table></figure>
<blockquote>
<p>也可以使用同样的命令将CA证书导入java 默认的 truststore($JAVA_HOME/jre/lib/security/cacerts), 也可以直接生成一个新的truststore, 不过这个truststore中只有你导入的要信任的CA证书.下面列出一段只信任某个根证书的代码:</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.http-client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>google-http-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.23.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keytool -import -file ~/Documents/GlobalSign\ Root\ CA.cer -alias globalSignCA -keystore trustStore</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpsTrustTool</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> <span class="keyword">throws</span> IOException, GeneralSecurityException</span>&#123;</span><br><span class="line">        FileInputStream myKeys = <span class="keyword">new</span> FileInputStream(<span class="string">"/tmp/trustStore"</span>);</span><br><span class="line">        KeyStore myTrustStore = KeyStore.getInstance(KeyStore.getDefaultType());</span><br><span class="line">        myTrustStore.load(myKeys, <span class="string">"123456"</span>.toCharArray());</span><br><span class="line"></span><br><span class="line">        NetHttpTransport netHttpTransport = <span class="keyword">new</span> NetHttpTransport.Builder().trustCertificates(myTrustStore).build();</span><br><span class="line">        HttpRequestFactory requestFactory = netHttpTransport.createRequestFactory();</span><br><span class="line"></span><br><span class="line">        HttpRequest request = requestFactory.buildGetRequest(<span class="keyword">new</span> GenericUrl(<span class="string">"https://u-api.alibaba-inc.com"</span>));</span><br><span class="line">        String rawResponse = request.execute().parseAsString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="查看Keystore中的内容"><a href="#查看Keystore中的内容" class="headerlink" title="查看Keystore中的内容"></a>查看Keystore中的内容</h3><h4 id="罗列jks文件中所有证书的指纹"><a href="#罗列jks文件中所有证书的指纹" class="headerlink" title="罗列jks文件中所有证书的指纹"></a>罗列jks文件中所有证书的指纹</h4><p>展示keystore.jks中的所有的签名的指纹, 并按照它们各自alias名称进行展示, 执行命令时也会被要求提供对应的密码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">keytool -list \</span><br><span class="line">        -keystore keystore.jks</span><br><span class="line"></span><br><span class="line">// 对于只需要展示一个alias别名对应的证书时</span><br><span class="line">keytool -list -keystore -alias domain keystore.jks</span><br></pre></td></tr></table></figure>
<h4 id="罗列jks文件中所有证书更详尽的信息"><a href="#罗列jks文件中所有证书更详尽的信息" class="headerlink" title="罗列jks文件中所有证书更详尽的信息"></a>罗列jks文件中所有证书更详尽的信息</h4><p>下面的命令会罗列出keystore中每一个条目的信息, 包含证书链的长度, 证书链中证书的指纹, DN信息， serial number, 创建和过期的时间等等。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">keytool -list -v \</span><br><span class="line">        -keystore keystore.jks</span><br><span class="line"></span><br><span class="line">// 比如罗列 $JAVA_HOME/jre/lib/security/cacerts的证书详细信息</span><br></pre></td></tr></table></figure>
<h4 id="罗列某一个签名后的证书的信息"><a href="#罗列某一个签名后的证书的信息" class="headerlink" title="罗列某一个签名后的证书的信息"></a>罗列某一个签名后的证书的信息</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">keytool -printcert \</span><br><span class="line">        -file domain.crt</span><br></pre></td></tr></table></figure>
<h3 id="更新KeyStore文件内容"><a href="#更新KeyStore文件内容" class="headerlink" title="更新KeyStore文件内容"></a>更新KeyStore文件内容</h3><h4 id="更改KeyStore文件的密码"><a href="#更改KeyStore文件的密码" class="headerlink" title="更改KeyStore文件的密码"></a>更改KeyStore文件的密码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">keytool -storepasswd \</span><br><span class="line">        -keystore keystore.jks</span><br></pre></td></tr></table></figure>
<h4 id="删除KeyStore文件中某个别名的条目"><a href="#删除KeyStore文件中某个别名的条目" class="headerlink" title="删除KeyStore文件中某个别名的条目"></a>删除KeyStore文件中某个别名的条目</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">keytool -delete \</span><br><span class="line">        -alias domain \</span><br><span class="line">        -keystore keystore.jks</span><br></pre></td></tr></table></figure>
<h4 id="更改KeyStore文件中某个条目的别名"><a href="#更改KeyStore文件中某个条目的别名" class="headerlink" title="更改KeyStore文件中某个条目的别名"></a>更改KeyStore文件中某个条目的别名</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">keytool -changealias \</span><br><span class="line">        -alias domain \</span><br><span class="line">        -destalias newdomain \</span><br><span class="line">        -keystore keystore.jks</span><br></pre></td></tr></table></figure></div><div class="tags"><a href="/blog_deploy/tags/Java/">Java</a><a href="/blog_deploy/tags/SSL/">SSL</a><a href="/blog_deploy/tags/Openssl/">Openssl</a><a href="/blog_deploy/tags/KeyStore/">KeyStore</a></div><div class="post-nav"><a class="pre" href="/blog_deploy/2018/Java_SSL_2/">Java_SSL详解(二)</a><a class="next" href="/blog_deploy/2018/nginx_config/">Nginx配置文件全剖析</a></div><div id="container"></div><link rel="stylesheet" href="/blog_deploy/css/default.css?v=0.0.0"><script src="/blog_deploy/js/gitment.browser.js?v=0.0.0"></script><script>var gitment = new Gitment({
  owner: 'geek-frio',
  repo: 'geek-frio.github.io',
  oauth: {
    client_id: 'c932c463c47bd6dfa128',
    client_secret: '75354bbd7b056095ef7e38e05fc72b6a9a9bbec7',
  },
})
gitment.render('container')
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://www.geekiknow.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/blog_deploy/tags/Java/" style="font-size: 15px;">Java</a> <a href="/blog_deploy/tags/SSL/" style="font-size: 15px;">SSL</a> <a href="/blog_deploy/tags/Openssl/" style="font-size: 15px;">Openssl</a> <a href="/blog_deploy/tags/KeyStore/" style="font-size: 15px;">KeyStore</a> <a href="/blog_deploy/tags/nginx/" style="font-size: 15px;">nginx</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/blog_deploy/2018/Java_SSL_2/">Java_SSL详解(二)</a></li><li class="post-list-item"><a class="post-list-link" href="/blog_deploy/2018/Java_SSL_1/">Java_SSL详解(一)</a></li><li class="post-list-item"><a class="post-list-link" href="/blog_deploy/2018/nginx_config/">Nginx配置文件全剖析</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/blog_deploy/." rel="nofollow">Just Do It.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/blog_deploy/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/blog_deploy/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/blog_deploy/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/blog_deploy/js/smartresize.js?v=0.0.0"></script></div></body></html>